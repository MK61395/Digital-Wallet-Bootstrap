<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Wallet - Add Item</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #1a3636;
        color: white;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      .navbar-custom {
        background-color: #40534c;
        padding: 1rem;
      }

      .navbar-custom .navbar-brand {
        margin: 0 auto;
        font-size: 1.5rem;
        color: #d6bd98;
      }

      .navbar-custom .material-icons {
        color: #d6bd98;
      }

      .card-custom {
        background-color: #40534c;
        color: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .form-control {
        background-color: rgba(103, 125, 106, 0.6);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        background-color: rgba(103, 125, 106, 0.8);
        color: white;
        border-color: #d6bd98;
        box-shadow: 0 0 0 3px rgba(214, 189, 152, 0.25);
      }

      .btn-custom {
        background-color: #d6bd98;
        color: #1a3636;
        font-weight: 600;
        padding: 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
        width: 100%;
      }

      .btn-custom:hover {
        background-color: #c7a57d;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .items-list {
        padding: 1rem;
      }

      .item-card {
        background-color: #677d6a;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 10px;
      }

      .custom-margin {
        margin-left: 20px; /* Adjust this value as needed */
      }

      /* Add these styles */
      .notification-icon,
      .logout-icon{
        cursor: pointer; /* Change cursor to pointer */
        margin-left: 20px; /* Add space between icons */
        transition: color 0.3s ease; /* Smooth color transition */
      }

      .notification-icon:hover,
      .logout-icon:hover, .home-icon:hover {
        color: #1a3636; /* Change color on hover */
      }

      .home-icon{
        cursor: pointer; /* Change cursor to pointer */
         /* Add space between icons */
        transition: color 0.3s ease; /* Smooth color transition */
      }

      .image-upload-container {
        background-color: rgba(103, 125, 106, 0.6);
        border: 2px dashed #d6bd98;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .image-upload-container:hover {
        background-color: rgba(103, 125, 106, 0.8);
      }

      #uploadedImage {
        max-width: 100%;
        max-height: 200px;
        margin-top: 10px;
        border-radius: 8px;
      }

      @media (max-width: 768px) {
        .items-list {
          padding: 0;
        }
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-custom">
      <div class="container-fluid">
        <span class="material-icons float-start home-icon" id="homeBtn"
          >home</span
        >
        <span class="navbar-brand text-center">Digital Wallet</span>
        <span class="material-icons float-end notification-icon"
          >notifications</span
        >
        <span
          class="material-icons float-end logout-icon custom-margin"
          id="logoutBtn"
          >logout</span
        >
      </div>
    </nav>

    <!-- Add Item Form -->
    <div class="container my-4">
      <div class="card-custom">
        <h5>Add New Item</h5>
        <form id="addItemForm">
          <!-- Select Item Type -->
          <div class="mb-3">
            <label for="itemType" class="form-label">Item Type</label>
            <select class="form-control" id="itemType" required>
              <option value="">Select Item Type</option>
              <option value="card">Credit/Debit Card</option>
              <option value="ticket">Ticket/Pass</option>
              <option value="password">Password</option>
            </select>
          </div>

          <!-- Card Fields -->
          <div id="cardFields" class="d-none">
            <div class="mb-3">
              <label for="cardNumber" class="form-label">Card Number</label>
              <input
                type="text"
                class="form-control"
                id="cardNumber"
                placeholder="Enter card number"
              />
            </div>
            <div class="mb-3">
              <label for="expirationDate" class="form-label"
                >Expiration Date</label
              >
              <input
                type="text"
                class="form-control"
                id="expirationDate"
                placeholder="MM/YY"
              />
            </div>
            <div class="mb-3">
              <label for="cvv" class="form-label">CVV</label>
              <input
                type="text"
                class="form-control"
                id="cvv"
                placeholder="Enter CVV"
              />
            </div>
          </div>

          <!-- Ticket/Pass Fields -->
          <div id="ticketFields" class="d-none">
            <div class="mb-3">
              <label for="ticketType" class="form-label">Ticket Type</label>
              <input
                type="text"
                class="form-control"
                id="ticketType"
                placeholder="e.g., Train, Movie"
              />
            </div>
            <div class="mb-3">
              <label for="ticketDate" class="form-label">Date</label>
              <input type="date" class="form-control" id="ticketDate" />
            </div>
            <div class="mb-3">
              <label for="ticketTime" class="form-label">Time</label>
              <input type="time" class="form-control" id="ticketTime" />
            </div>
            <div class="mb-3">
              <label for="ticketPlace" class="form-label">Place</label>
              <input
                type="text"
                class="form-control"
                id="ticketPlace"
                placeholder="Enter place"
              />
            </div>
          </div>

          <!-- Password Fields -->
          <div id="passwordFields" class="d-none">
            <div class="mb-3">
              <label for="website" class="form-label">Website Name</label>
              <input
                type="text"
                class="form-control"
                id="website"
                placeholder="Enter website"
              />
            </div>
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              <input
                type="text"
                class="form-control"
                id="username"
                placeholder="Enter username"
              />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="password"
                placeholder="Enter password"
              />
            </div>
          </div>

          <div class="mb-3">
            <h5>Upload Image</h5>
            <select class="form-control" id="imageItemType">
              <option value="">Select Item Type</option>
              <option value="card">Credit/Debit Card</option>
              <option value="ticket">Ticket/Pass</option>
            </select>
          </div>
          <div class="image-upload-container" id="imageUploadContainer">
            <input type="file" id="imageInput" accept="image/*" style="display: none;" />
            <p>Click to upload an image or drag and drop here</p>
            <img id="uploadedImage" style="display: none;" />
          </div>
          <div id="extractedInfo" class="mt-3"></div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-custom">Save Item</button>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script>
      // Show fields based on item type
      document
        .getElementById("itemType")
        .addEventListener("change", function () {
          const itemType = this.value;
          document.getElementById("cardFields").classList.add("d-none");
          document.getElementById("ticketFields").classList.add("d-none");
          document.getElementById("passwordFields").classList.add("d-none");

          if (itemType === "card") {
            document.getElementById("cardFields").classList.remove("d-none");
          } else if (itemType === "ticket") {
            document.getElementById("ticketFields").classList.remove("d-none");
          } else if (itemType === "password") {
            document
              .getElementById("passwordFields")
              .classList.remove("d-none");
          }
        });

      // Save the item to localStorage and redirect
      document
        .getElementById("addItemForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const itemType = document.getElementById("itemType").value;
          let itemData = {};

          if (itemType === "card") {
            itemData = {
              type: "Card",
              number: document.getElementById("cardNumber").value,
              expirationDate: document.getElementById("expirationDate").value,
              cvv: document.getElementById("cvv").value,
            };
          } else if (itemType === "ticket") {
            itemData = {
              type: "Ticket",
              ticketType: document.getElementById("ticketType").value,
              date: document.getElementById("ticketDate").value,
              time: document.getElementById("ticketTime").value,
              place: document.getElementById("ticketPlace").value,
            };
          } else if (itemType === "password") {
            itemData = {
              type: "Password",
              website: document.getElementById("website").value,
              username: document.getElementById("username").value,
              password: document.getElementById("password").value,
            };
          }

          // Get items from localStorage or initialize an empty array
          const items = JSON.parse(localStorage.getItem("walletItems")) || [];
          items.push(itemData);
          localStorage.setItem("walletItems", JSON.stringify(items));

          alert("Item saved successfully!");

          // Redirect to the dashboard
          window.location.href = "dashboard.html";
        });

        const imageUploadContainer = document.getElementById('imageUploadContainer');
      const imageInput = document.getElementById('imageInput');
      const uploadedImage = document.getElementById('uploadedImage');
      const extractedInfo = document.getElementById('extractedInfo');
      const imageItemType = document.getElementById('imageItemType');

      imageUploadContainer.addEventListener('click', () => imageInput.click());
      imageUploadContainer.addEventListener('dragover', (e) => {
        e.preventDefault();
        imageUploadContainer.style.backgroundColor = 'rgba(103, 125, 106, 0.8)';
      });
      imageUploadContainer.addEventListener('dragleave', () => {
        imageUploadContainer.style.backgroundColor = 'rgba(103, 125, 106, 0.6)';
      });
      imageUploadContainer.addEventListener('drop', handleDrop);

      imageInput.addEventListener('change', handleFileSelect);

      function handleDrop(e) {
        e.preventDefault();
        imageUploadContainer.style.backgroundColor = 'rgba(103, 125, 106, 0.6)';
        handleFiles(e.dataTransfer.files);
      }

      function handleFileSelect(e) {
        handleFiles(e.target.files);
      }

      function handleFiles(files) {
        if (files.length > 0) {
          const file = files[0];
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
              uploadedImage.src = e.target.result;
              uploadedImage.style.display = 'block';
              extractImageInfo(e.target.result);
            };
            reader.readAsDataURL(file);
          } else {
            alert('Please upload an image file.');
          }
        }
      }

      function extractImageInfo(imageData) {
        const itemType = imageItemType.value;
        if (!itemType) {
          alert('Please select an item type before uploading an image.');
          return;
        }

        Tesseract.recognize(imageData).then(({ data: { text } }) => {
          let extractedData = {};
          if (itemType === 'card') {
            extractedData = extractCardInfo(text);
          } else if (itemType === 'ticket') {
            extractedData = extractTicketInfo(text);
          }
          displayExtractedInfo(extractedData);
        });
      }

      function extractCardInfo(text) {
        const cardNumber = text.match(/\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}/);
        const expiryDate = text.match(/(0[1-9]|1[0-2])\/?([0-9]{2})/);
        const cvv = text.match(/\b\d{3}\b/);

        return {
          cardNumber: cardNumber ? cardNumber[0] : 'Not found',
          expiryDate: expiryDate ? expiryDate[0] : 'Not found',
          cvv: cvv ? cvv[0] : 'Not found'
        };
      }

      function extractTicketInfo(text) {
        const date = text.match(/\d{1,2}[-/]\d{1,2}[-/]\d{2,4}/);
        const time = text.match(/\d{1,2}:\d{2}/);
        const place = text.match(/[A-Z][a-z]+(\s[A-Z][a-z]+)*/);

        return {
          date: date ? date[0] : 'Not found',
          time: time ? time[0] : 'Not found',
          place: place ? place[0] : 'Not found'
        };
      }

      function displayExtractedInfo(data) {
        let html = '<h6>Extracted Information:</h6>';
        for (const [key, value] of Object.entries(data)) {
          html += `<p><strong>${key}:</strong> ${value}</p>`;
        }
        extractedInfo.innerHTML = html;
      }

      document
        .getElementById("logoutBtn")
        .addEventListener("click", function () {
          window.location.href = "signup.html"; // Redirect to signup.html
        });

        document.getElementById("homeBtn").addEventListener("click", function () {
        window.location.href = "dashboard.html"; // Redirect to signup.html
      });
    </script>
  </body>
</html>
